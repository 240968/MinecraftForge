--- a/net/minecraft/network/Connection.java
+++ b/net/minecraft/network/Connection.java
@@ -102,6 +_,7 @@
    private volatile Component f_290021_;
    @Nullable
    BandwidthDebugMonitor f_291520_;
+   private java.util.function.Consumer<Connection> activationHandler;
 
    public Connection(PacketFlow p_129482_) {
       this.f_129466_ = p_129482_;
@@ -111,6 +_,7 @@
       super.channelActive(p_129525_);
       this.f_129468_ = p_129525_.channel();
       this.f_129469_ = this.f_129468_.remoteAddress();
+      if (activationHandler != null) activationHandler.accept(this);
       if (this.f_290021_ != null) {
          this.m_129507_(this.f_290021_);
       }
@@ -395,7 +_,7 @@
       if (this.f_129469_ == null) {
          return "local";
       } else {
-         return p_298740_ ? this.f_129469_.toString() : "IP hidden";
+         return p_298740_ ? net.minecraftforge.network.DualStackUtils.getAddressString(this.f_129469_) : "IP hidden";
       }
    }
 
@@ -435,6 +_,8 @@
    }
 
    public static ChannelFuture m_290025_(InetSocketAddress p_290034_, boolean p_290035_, final Connection p_290031_) {
+      net.minecraftforge.network.DualStackUtils.checkIPv6(p_290034_.getAddress());
+      p_290031_.activationHandler = net.minecraftforge.network.NetworkHooks::registerClientLoginChannel;
       Class<? extends SocketChannel> oclass;
       EventLoopGroup eventloopgroup;
       if (Epoll.isAvailable() && p_290035_) {
@@ -485,6 +_,7 @@
 
    public static Connection m_129493_(SocketAddress p_129494_) {
       final Connection connection = new Connection(PacketFlow.CLIENTBOUND);
+      connection.activationHandler = net.minecraftforge.network.NetworkHooks::registerClientLoginChannel;
       (new Bootstrap()).group(f_129464_.get()).handler(new ChannelInitializer<Channel>() {
          protected void initChannel(Channel p_129557_) {
             Connection.m_294111_(p_129557_);
@@ -581,6 +_,14 @@
 
    public float m_129543_() {
       return this.f_129477_;
+   }
+
+   public Channel channel() {
+      return this.f_129468_;
+   }
+
+   public PacketFlow getDirection() {
+      return this.f_129466_;
    }
 
    public void m_292855_(SampleLogger p_300126_) {
